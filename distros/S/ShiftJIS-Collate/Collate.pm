package ShiftJIS::Collate;

use Carp;
use strict;
use vars qw($VERSION $PACKAGE @ISA @EXPORT @EXPORT_OK %EXPORT_TAGS);

$VERSION = '1.10';

$PACKAGE = 'ShiftJIS::Collate'; # __PACKAGE__

my $Level = 4;
my $Kanji = 2;

sub new {
    my $class = shift;
    my $self  = bless { @_ }, $class;

    $self->{level} ||= $Level;
    $self->{kanji} ||= $Kanji;

    if ($self->{kanji} == 3) {
	croak qq|$PACKAGE "tounicode" coderef is not defined|
	    unless $self->{tounicode} && ref($self->{tounicode}) eq 'CODE';
    }
    if (exists $self->{overrideCJK}) {
	croak qq|$PACKAGE : Sorry, "overrideCJK" is obsolete.|;
    }
    return $self;
}


my $Char = '[\xB3\xB6-\xC4]\xDE|[\xCA-\xCE][\xDE\xDF]|'
    . '[\x00-\x7F\xA1-\xDF]|[\x81-\x9F\xE0-\xFC][\x40-\x7E\x80-\xFC]';

my $CJK = '\x88[\x9F-\xFC]|\x98[\x40-\x72\x9F-\xFC]|'
    . '[\x89-\x97\x99-\x9F\xE0-\xE9][\x40-\x7E\x80-\xFC]|'
    . '\xEA[\x40-\x7E\x80-\xA4]';


#
# 1st weights
#
#  /[\x41-\xFF]{2}/
#
# 2nd weights
#  "\x32" : unaffected
#  "\x33" : normal latin
#  "\x34" : voiceless kana
#  "\x35" : voiced kana
#  "\x36" : semivoiced kana
#
# 3rd weights
#  "\x14" : unaffected
#  "\x15" : lower latin
#  "\x16" : upper latin
#  "\x1a" : prolonged kana
#  "\x1b" : small kana
#  "\x1c" : iteration kana
#  "\x1d" : normal kana
#
# 4th weights
#  "\x0a" : unaffected
#  "\x10" : hiragana
#  "\x11" : katakana
#
# 5th weights
#  "\x01" : unaffected
#  "\x02" : normal ascii
#  "\x03" : normal kana
#  "\x04" : compat kana
#  "\x05" : compat ascii
#
my %Order = (

' '  => "\x70\x41\x32\x14\x0a\x01",
'Å@' => "\x70\x42\x32\x14\x0a\x01",
'ÅA' => "\x71\x41\x32\x14\x0a\x03",
'§'  => "\x71\x41\x32\x14\x0a\x04",
'ÅB' => "\x71\x42\x32\x14\x0a\x03",
'°'  => "\x71\x42\x32\x14\x0a\x04",
','  => "\x71\x43\x32\x14\x0a\x02",
'ÅC' => "\x71\x43\x32\x14\x0a\x05",
'.'  => "\x71\x44\x32\x14\x0a\x02",
'ÅD' => "\x71\x44\x32\x14\x0a\x05",
'ÅE' => "\x71\x45\x32\x14\x0a\x03",
'•'  => "\x71\x45\x32\x14\x0a\x04",
':'  => "\x71\x46\x32\x14\x0a\x02",
'ÅF' => "\x71\x46\x32\x14\x0a\x05",
';'  => "\x71\x47\x32\x14\x0a\x02",
'ÅG' => "\x71\x47\x32\x14\x0a\x05",
'?'  => "\x71\x48\x32\x14\x0a\x02",
'ÅH' => "\x71\x48\x32\x14\x0a\x05",
'!'  => "\x71\x49\x32\x14\x0a\x02",
'ÅI' => "\x71\x49\x32\x14\x0a\x05",
'ÅL' => "\x71\x4a\x32\x14\x0a\x01",#added
'`'  => "\x71\x4b\x32\x14\x0a\x02",#added
'ÅM' => "\x71\x4b\x32\x14\x0a\x05",#added
'ÅN' => "\x71\x4c\x32\x14\x0a\x01",#added
'^'  => "\x71\x4d\x32\x14\x0a\x02",#added
'ÅO' => "\x71\x4d\x32\x14\x0a\x05",#added
'~'  => "\x71\x4e\x32\x14\x0a\x02",
'ÅP' => "\x71\x4e\x32\x14\x0a\x05",
'_'  => "\x71\x4f\x32\x14\x0a\x02",
'ÅQ' => "\x71\x4f\x32\x14\x0a\x05",
(qw/Å\ /)[0]
     => "\x71\x50\x32\x14\x0a\x01",
'Å]' => "\x71\x51\x32\x14\x0a\x01",
'/'  => "\x71\x52\x32\x14\x0a\x02",
'Å^' => "\x71\x52\x32\x14\x0a\x05",
'Å_' => "\x71\x53\x32\x14\x0a\x01",
'Å`' => "\x71\x54\x32\x14\x0a\x01",
'Åa' => "\x71\x55\x32\x14\x0a\x01",
'|'  => "\x71\x56\x32\x14\x0a\x02",
'Åb' => "\x71\x56\x32\x14\x0a\x05",
'Åc' => "\x71\x57\x32\x14\x0a\x01",
'Åd' => "\x71\x58\x32\x14\x0a\x01",
q|Åe|=> "\x72\x41\x32\x14\x0a\x01",
q|Åf|=> "\x72\x42\x32\x14\x0a\x01",
q|'| => "\x72\x43\x32\x14\x0a\x01",#added
q|Åg|=> "\x72\x44\x32\x14\x0a\x01",
q|Åh|=> "\x72\x45\x32\x14\x0a\x01",
q|"| => "\x72\x46\x32\x14\x0a\x01",#added
'('  => "\x72\x47\x32\x14\x0a\x02",
'Åi' => "\x72\x47\x32\x14\x0a\x05",
')'  => "\x72\x48\x32\x14\x0a\x02",
'Åj' => "\x72\x48\x32\x14\x0a\x05",
'Åk' => "\x72\x49\x32\x14\x0a\x01",
'Ål' => "\x72\x4a\x32\x14\x0a\x01",
'['  => "\x72\x4b\x32\x14\x0a\x02",
'Åm' => "\x72\x4b\x32\x14\x0a\x05",
']'  => "\x72\x4c\x32\x14\x0a\x02",
'Ån' => "\x72\x4c\x32\x14\x0a\x05",
'{'  => "\x72\x4d\x32\x14\x0a\x02",
'Åo' => "\x72\x4d\x32\x14\x0a\x05",
'}'  => "\x72\x4e\x32\x14\x0a\x02",
'Åp' => "\x72\x4e\x32\x14\x0a\x05",
'Åq' => "\x72\x4f\x32\x14\x0a\x01",
'År' => "\x72\x50\x32\x14\x0a\x01",
'Ås' => "\x72\x51\x32\x14\x0a\x01",
'Åt' => "\x72\x52\x32\x14\x0a\x01",
'Åu' => "\x72\x53\x32\x14\x0a\x03",
'¢'  => "\x72\x53\x32\x14\x0a\x04",
'Åv' => "\x72\x54\x32\x14\x0a\x03",
'£'  => "\x72\x54\x32\x14\x0a\x04",
'Åw' => "\x72\x55\x32\x14\x0a\x01",
'Åx' => "\x72\x56\x32\x14\x0a\x01",
'Åy' => "\x72\x57\x32\x14\x0a\x01",
'Åz' => "\x72\x58\x32\x14\x0a\x01",
'+'  => "\x73\x41\x32\x14\x0a\x02",
'Å{' => "\x73\x41\x32\x14\x0a\x05",
'-'  => "\x73\x42\x32\x14\x0a\x01",#added
'Å|' => "\x73\x43\x32\x14\x0a\x01",
'Å}' => "\x73\x44\x32\x14\x0a\x01",
'Å~' => "\x73\x45\x32\x14\x0a\x01",
'ÅÄ' => "\x73\x46\x32\x14\x0a\x01",
'='  => "\x73\x47\x32\x14\x0a\x02",
'ÅÅ' => "\x73\x47\x32\x14\x0a\x05",
'ÅÇ' => "\x73\x48\x32\x14\x0a\x01",
'<'  => "\x73\x49\x32\x14\x0a\x02",
'ÅÉ' => "\x73\x49\x32\x14\x0a\x05",
'>'  => "\x73\x4a\x32\x14\x0a\x02",
'ÅÑ' => "\x73\x4a\x32\x14\x0a\x05",
'ÅÖ' => "\x73\x4b\x32\x14\x0a\x01",
'ÅÜ' => "\x73\x4c\x32\x14\x0a\x01",
'Å‡' => "\x73\x4d\x32\x14\x0a\x01",
'Å·' => "\x73\x4e\x32\x14\x0a\x01",
'Å‚' => "\x73\x4f\x32\x14\x0a\x01",
'ÅÂ' => "\x73\x50\x32\x14\x0a\x01",
'Åá' => "\x73\x51\x32\x14\x0a\x01",
'Å›' => "\x73\x52\x32\x14\x0a\x01",
'Åﬁ' => "\x73\x53\x32\x14\x0a\x01",
'Å„' => "\x73\x54\x32\x14\x0a\x01",
'ÅÁ' => "\x73\x55\x32\x14\x0a\x01",
'ÅË' => "\x73\x56\x32\x14\x0a\x01",
'Å⁄' => "\x73\x57\x32\x14\x0a\x01",
'Å€' => "\x73\x58\x32\x14\x0a\x01",
'Å‹' => "\x73\x59\x32\x14\x0a\x01",
'Åﬂ' => "\x73\x5a\x32\x14\x0a\x01",
'Å‰' => "\x73\x5b\x32\x14\x0a\x01",
'Å∏' => "\x73\x5c\x32\x14\x0a\x01",
'Åπ' => "\x73\x5d\x32\x14\x0a\x01",
'Å∫' => "\x73\x5e\x32\x14\x0a\x01",
'Åª' => "\x73\x5f\x32\x14\x0a\x01",
'Åº' => "\x73\x60\x32\x14\x0a\x01",
'ÅΩ' => "\x73\x61\x32\x14\x0a\x01",
'Åæ' => "\x73\x62\x32\x14\x0a\x01",
'Åø' => "\x73\x63\x32\x14\x0a\x01",
'Å»' => "\x73\x64\x32\x14\x0a\x01",
'Å…' => "\x73\x65\x32\x14\x0a\x01",
'Å ' => "\x73\x66\x32\x14\x0a\x01",
'ÅÀ' => "\x73\x67\x32\x14\x0a\x01",
'ÅÃ' => "\x73\x68\x32\x14\x0a\x01",
'ÅÕ' => "\x73\x69\x32\x14\x0a\x01",
'ÅŒ' => "\x73\x6a\x32\x14\x0a\x01",
'Åà' => "\x73\x6b\x32\x14\x0a\x01",
'ÅÊ' => "\x73\x6c\x32\x14\x0a\x01",
'Åâ' => "\x73\x6d\x32\x14\x0a\x01",
'Åä' => "\x73\x6e\x32\x14\x0a\x01",
'#'  => "\x74\x41\x32\x14\x0a\x02",
'Åî' => "\x74\x41\x32\x14\x0a\x05",
'&'  => "\x74\x42\x32\x14\x0a\x02",
'Åï' => "\x74\x42\x32\x14\x0a\x05",
'*'  => "\x74\x43\x32\x14\x0a\x02",
'Åñ' => "\x74\x43\x32\x14\x0a\x05",
'@'  => "\x74\x44\x32\x14\x0a\x02",
'Åó' => "\x74\x44\x32\x14\x0a\x05",
'Åò' => "\x74\x45\x32\x14\x0a\x01",
'Å˜' => "\x74\x46\x32\x14\x0a\x01",
'Å¶' => "\x74\x47\x32\x14\x0a\x01",
'Åı' => "\x74\x48\x32\x14\x0a\x01",
'Åˆ' => "\x74\x49\x32\x14\x0a\x01",
'Åô' => "\x74\x4a\x32\x14\x0a\x01",
'Åö' => "\x74\x4b\x32\x14\x0a\x01",
'Åõ' => "\x74\x4c\x32\x14\x0a\x01",
'Åú' => "\x74\x4d\x32\x14\x0a\x01",
'Åù' => "\x74\x4e\x32\x14\x0a\x01",
'Åû' => "\x74\x4f\x32\x14\x0a\x01",
'Åü' => "\x74\x50\x32\x14\x0a\x01",
'Å†' => "\x74\x51\x32\x14\x0a\x01",
'Å°' => "\x74\x52\x32\x14\x0a\x01",
'Å¢' => "\x74\x53\x32\x14\x0a\x01",
'Å£' => "\x74\x54\x32\x14\x0a\x01",
'Å§' => "\x74\x55\x32\x14\x0a\x01",
'Å•' => "\x74\x56\x32\x14\x0a\x01",
'Åß' => "\x74\x57\x32\x14\x0a\x01",
'Å®' => "\x74\x58\x32\x14\x0a\x01",
'Å©' => "\x74\x59\x32\x14\x0a\x01",
'Å™' => "\x74\x5a\x32\x14\x0a\x01",
'Å´' => "\x74\x5b\x32\x14\x0a\x01",
'ÅÚ' => "\x74\x5c\x32\x14\x0a\x01",
'ÅÛ' => "\x74\x5d\x32\x14\x0a\x01",
'ÅÙ' => "\x74\x5e\x32\x14\x0a\x01",
'Åã' => "\x75\x41\x32\x14\x0a\x01",
'Åå' => "\x75\x42\x32\x14\x0a\x01",
'Åç' => "\x75\x43\x32\x14\x0a\x01",
'Åé' => "\x75\x44\x32\x14\x0a\x01",
'\\' => "\x75\x45\x32\x14\x0a\x02",
'Åè' => "\x75\x45\x32\x14\x0a\x05",
'$'  => "\x75\x46\x32\x14\x0a\x02",
'Åê' => "\x75\x46\x32\x14\x0a\x05",
'Åë' => "\x75\x47\x32\x14\x0a\x01",
'Åí' => "\x75\x48\x32\x14\x0a\x01",
'%'  => "\x75\x49\x32\x14\x0a\x02",
'Åì' => "\x75\x49\x32\x14\x0a\x05",
'ÅÒ' => "\x75\x4a\x32\x14\x0a\x01",
'Å' => "\x75\x4b\x32\x14\x0a\x01",
'0'  => "\x76\x41\x32\x14\x0a\x02",
'ÇO' => "\x76\x41\x32\x14\x0a\x05",
'1'  => "\x76\x42\x32\x14\x0a\x02",
'ÇP' => "\x76\x42\x32\x14\x0a\x05",
'2'  => "\x76\x43\x32\x14\x0a\x02",
'ÇQ' => "\x76\x43\x32\x14\x0a\x05",
'3'  => "\x76\x44\x32\x14\x0a\x02",
'ÇR' => "\x76\x44\x32\x14\x0a\x05",
'4'  => "\x76\x45\x32\x14\x0a\x02",
'ÇS' => "\x76\x45\x32\x14\x0a\x05",
'5'  => "\x76\x46\x32\x14\x0a\x02",
'ÇT' => "\x76\x46\x32\x14\x0a\x05",
'6'  => "\x76\x47\x32\x14\x0a\x02",
'ÇU' => "\x76\x47\x32\x14\x0a\x05",
'7'  => "\x76\x48\x32\x14\x0a\x02",
'ÇV' => "\x76\x48\x32\x14\x0a\x05",
'8'  => "\x76\x49\x32\x14\x0a\x02",
'ÇW' => "\x76\x49\x32\x14\x0a\x05",
'9'  => "\x76\x4a\x32\x14\x0a\x02",
'ÇX' => "\x76\x4a\x32\x14\x0a\x05",
'Éø' => "\x77\x41\x32\x14\x0a\x01",
'É¿' => "\x77\x42\x32\x14\x0a\x01",
'É¡' => "\x77\x43\x32\x14\x0a\x01",
'É¬' => "\x77\x44\x32\x14\x0a\x01",
'É√' => "\x77\x45\x32\x14\x0a\x01",
'Éƒ' => "\x77\x46\x32\x14\x0a\x01",
'É≈' => "\x77\x47\x32\x14\x0a\x01",
'É∆' => "\x77\x48\x32\x14\x0a\x01",
'É«' => "\x77\x49\x32\x14\x0a\x01",
'É»' => "\x77\x4a\x32\x14\x0a\x01",
'É…' => "\x77\x4b\x32\x14\x0a\x01",
'É ' => "\x77\x4c\x32\x14\x0a\x01",
'ÉÀ' => "\x77\x4d\x32\x14\x0a\x01",
'ÉÃ' => "\x77\x4e\x32\x14\x0a\x01",
'ÉÕ' => "\x77\x4f\x32\x14\x0a\x01",
'ÉŒ' => "\x77\x50\x32\x14\x0a\x01",
'Éœ' => "\x77\x51\x32\x14\x0a\x01",
'É–' => "\x77\x52\x32\x14\x0a\x01",
'É—' => "\x77\x53\x32\x14\x0a\x01",
'É“' => "\x77\x54\x32\x14\x0a\x01",
'É”' => "\x77\x55\x32\x14\x0a\x01",
'É‘' => "\x77\x56\x32\x14\x0a\x01",
'É’' => "\x77\x57\x32\x14\x0a\x01",
'É÷' => "\x77\x58\x32\x14\x0a\x01",
'Éü' => "\x77\x61\x32\x14\x0a\x01",
'É†' => "\x77\x62\x32\x14\x0a\x01",
'É°' => "\x77\x63\x32\x14\x0a\x01",
'É¢' => "\x77\x64\x32\x14\x0a\x01",
'É£' => "\x77\x65\x32\x14\x0a\x01",
'É§' => "\x77\x66\x32\x14\x0a\x01",
'É•' => "\x77\x67\x32\x14\x0a\x01",
'É¶' => "\x77\x68\x32\x14\x0a\x01",
'Éß' => "\x77\x69\x32\x14\x0a\x01",
'É®' => "\x77\x6a\x32\x14\x0a\x01",
'É©' => "\x77\x6b\x32\x14\x0a\x01",
'É™' => "\x77\x6c\x32\x14\x0a\x01",
'É´' => "\x77\x6d\x32\x14\x0a\x01",
'É¨' => "\x77\x6e\x32\x14\x0a\x01",
'É≠' => "\x77\x6f\x32\x14\x0a\x01",
'ÉÆ' => "\x77\x70\x32\x14\x0a\x01",
'ÉØ' => "\x77\x71\x32\x14\x0a\x01",
'É∞' => "\x77\x72\x32\x14\x0a\x01",
'É±' => "\x77\x73\x32\x14\x0a\x01",
'É≤' => "\x77\x74\x32\x14\x0a\x01",
'É≥' => "\x77\x75\x32\x14\x0a\x01",
'É¥' => "\x77\x76\x32\x14\x0a\x01",
'Éµ' => "\x77\x77\x32\x14\x0a\x01",
'É∂' => "\x77\x78\x32\x14\x0a\x01",
'Ñp' => "\x77\x81\x32\x14\x0a\x01",
'Ñq' => "\x77\x82\x32\x14\x0a\x01",
'Ñr' => "\x77\x83\x32\x14\x0a\x01",
'Ñs' => "\x77\x84\x32\x14\x0a\x01",
'Ñt' => "\x77\x85\x32\x14\x0a\x01",
'Ñu' => "\x77\x86\x32\x14\x0a\x01",
'Ñv' => "\x77\x87\x32\x14\x0a\x01",
'Ñw' => "\x77\x88\x32\x14\x0a\x01",
'Ñx' => "\x77\x89\x32\x14\x0a\x01",
'Ñy' => "\x77\x8a\x32\x14\x0a\x01",
'Ñz' => "\x77\x8b\x32\x14\x0a\x01",
'Ñ{' => "\x77\x8c\x32\x14\x0a\x01",
'Ñ|' => "\x77\x8d\x32\x14\x0a\x01",
'Ñ}' => "\x77\x8e\x32\x14\x0a\x01",
'Ñ~' => "\x77\x8f\x32\x14\x0a\x01",
'ÑÄ' => "\x77\x90\x32\x14\x0a\x01",
'ÑÅ' => "\x77\x91\x32\x14\x0a\x01",
'ÑÇ' => "\x77\x92\x32\x14\x0a\x01",
'ÑÉ' => "\x77\x93\x32\x14\x0a\x01",
'ÑÑ' => "\x77\x94\x32\x14\x0a\x01",
'ÑÖ' => "\x77\x95\x32\x14\x0a\x01",
'ÑÜ' => "\x77\x96\x32\x14\x0a\x01",
'Ñá' => "\x77\x97\x32\x14\x0a\x01",
'Ñà' => "\x77\x98\x32\x14\x0a\x01",
'Ñâ' => "\x77\x99\x32\x14\x0a\x01",
'Ñä' => "\x77\x9a\x32\x14\x0a\x01",
'Ñã' => "\x77\x9b\x32\x14\x0a\x01",
'Ñå' => "\x77\x9c\x32\x14\x0a\x01",
'Ñç' => "\x77\x9d\x32\x14\x0a\x01",
'Ñé' => "\x77\x9e\x32\x14\x0a\x01",
'Ñè' => "\x77\x9f\x32\x14\x0a\x01",
'Ñê' => "\x77\xa0\x32\x14\x0a\x01",
'Ñë' => "\x77\xa1\x32\x14\x0a\x01",
'Ñ@' => "\x77\xb1\x32\x14\x0a\x01",
'ÑA' => "\x77\xb2\x32\x14\x0a\x01",
'ÑB' => "\x77\xb3\x32\x14\x0a\x01",
'ÑC' => "\x77\xb4\x32\x14\x0a\x01",
'ÑD' => "\x77\xb5\x32\x14\x0a\x01",
'ÑE' => "\x77\xb6\x32\x14\x0a\x01",
'ÑF' => "\x77\xb7\x32\x14\x0a\x01",
'ÑG' => "\x77\xb8\x32\x14\x0a\x01",
'ÑH' => "\x77\xb9\x32\x14\x0a\x01",
'ÑI' => "\x77\xba\x32\x14\x0a\x01",
'ÑJ' => "\x77\xbb\x32\x14\x0a\x01",
'ÑK' => "\x77\xbc\x32\x14\x0a\x01",
'ÑL' => "\x77\xbd\x32\x14\x0a\x01",
'ÑM' => "\x77\xbe\x32\x14\x0a\x01",
'ÑN' => "\x77\xbf\x32\x14\x0a\x01",
'ÑO' => "\x77\xc0\x32\x14\x0a\x01",
'ÑP' => "\x77\xc1\x32\x14\x0a\x01",
'ÑQ' => "\x77\xc2\x32\x14\x0a\x01",
'ÑR' => "\x77\xc3\x32\x14\x0a\x01",
'ÑS' => "\x77\xc4\x32\x14\x0a\x01",
'ÑT' => "\x77\xc5\x32\x14\x0a\x01",
'ÑU' => "\x77\xc6\x32\x14\x0a\x01",
'ÑV' => "\x77\xc7\x32\x14\x0a\x01",
'ÑW' => "\x77\xc8\x32\x14\x0a\x01",
'ÑX' => "\x77\xc9\x32\x14\x0a\x01",
'ÑY' => "\x77\xca\x32\x14\x0a\x01",
'ÑZ' => "\x77\xcb\x32\x14\x0a\x01",
'Ñ[' => "\x77\xcc\x32\x14\x0a\x01",
(qw/Ñ\ /)[0]
     => "\x77\xcd\x32\x14\x0a\x01",
'Ñ]' => "\x77\xce\x32\x14\x0a\x01",
'Ñ^' => "\x77\xcf\x32\x14\x0a\x01",
'Ñ_' => "\x77\xd0\x32\x14\x0a\x01",
'Ñ`' => "\x77\xd1\x32\x14\x0a\x01",
'a'  => "\x78\x41\x33\x15\x0a\x02",
'ÇÅ' => "\x78\x41\x33\x15\x0a\x05",
'A'  => "\x78\x41\x33\x16\x0a\x02",
'Ç`' => "\x78\x41\x33\x16\x0a\x05",
'b'  => "\x78\x42\x33\x15\x0a\x02",
'ÇÇ' => "\x78\x42\x33\x15\x0a\x05",
'B'  => "\x78\x42\x33\x16\x0a\x02",
'Ça' => "\x78\x42\x33\x16\x0a\x05",
'c'  => "\x78\x43\x33\x15\x0a\x02",
'ÇÉ' => "\x78\x43\x33\x15\x0a\x05",
'C'  => "\x78\x43\x33\x16\x0a\x02",
'Çb' => "\x78\x43\x33\x16\x0a\x05",
'd'  => "\x78\x44\x33\x15\x0a\x02",
'ÇÑ' => "\x78\x44\x33\x15\x0a\x05",
'D'  => "\x78\x44\x33\x16\x0a\x02",
'Çc' => "\x78\x44\x33\x16\x0a\x05",
'e'  => "\x78\x45\x33\x15\x0a\x02",
'ÇÖ' => "\x78\x45\x33\x15\x0a\x05",
'E'  => "\x78\x45\x33\x16\x0a\x02",
'Çd' => "\x78\x45\x33\x16\x0a\x05",
'f'  => "\x78\x46\x33\x15\x0a\x02",
'ÇÜ' => "\x78\x46\x33\x15\x0a\x05",
'F'  => "\x78\x46\x33\x16\x0a\x02",
'Çe' => "\x78\x46\x33\x16\x0a\x05",
'g'  => "\x78\x47\x33\x15\x0a\x02",
'Çá' => "\x78\x47\x33\x15\x0a\x05",
'G'  => "\x78\x47\x33\x16\x0a\x02",
'Çf' => "\x78\x47\x33\x16\x0a\x05",
'h'  => "\x78\x48\x33\x15\x0a\x02",
'Çà' => "\x78\x48\x33\x15\x0a\x05",
'H'  => "\x78\x48\x33\x16\x0a\x02",
'Çg' => "\x78\x48\x33\x16\x0a\x05",
'i'  => "\x78\x49\x33\x15\x0a\x02",
'Çâ' => "\x78\x49\x33\x15\x0a\x05",
'I'  => "\x78\x49\x33\x16\x0a\x02",
'Çh' => "\x78\x49\x33\x16\x0a\x05",
'j'  => "\x78\x4a\x33\x15\x0a\x02",
'Çä' => "\x78\x4a\x33\x15\x0a\x05",
'J'  => "\x78\x4a\x33\x16\x0a\x02",
'Çi' => "\x78\x4a\x33\x16\x0a\x05",
'k'  => "\x78\x4b\x33\x15\x0a\x02",
'Çã' => "\x78\x4b\x33\x15\x0a\x05",
'K'  => "\x78\x4b\x33\x16\x0a\x02",
'Çj' => "\x78\x4b\x33\x16\x0a\x05",
'l'  => "\x78\x4c\x33\x15\x0a\x02",
'Çå' => "\x78\x4c\x33\x15\x0a\x05",
'L'  => "\x78\x4c\x33\x16\x0a\x02",
'Çk' => "\x78\x4c\x33\x16\x0a\x05",
'm'  => "\x78\x4d\x33\x15\x0a\x02",
'Çç' => "\x78\x4d\x33\x15\x0a\x05",
'M'  => "\x78\x4d\x33\x16\x0a\x02",
'Çl' => "\x78\x4d\x33\x16\x0a\x05",
'n'  => "\x78\x4e\x33\x15\x0a\x02",
'Çé' => "\x78\x4e\x33\x15\x0a\x05",
'N'  => "\x78\x4e\x33\x16\x0a\x02",
'Çm' => "\x78\x4e\x33\x16\x0a\x05",
'o'  => "\x78\x4f\x33\x15\x0a\x02",
'Çè' => "\x78\x4f\x33\x15\x0a\x05",
'O'  => "\x78\x4f\x33\x16\x0a\x02",
'Çn' => "\x78\x4f\x33\x16\x0a\x05",
'p'  => "\x78\x50\x33\x15\x0a\x02",
'Çê' => "\x78\x50\x33\x15\x0a\x05",
'P'  => "\x78\x50\x33\x16\x0a\x02",
'Ço' => "\x78\x50\x33\x16\x0a\x05",
'q'  => "\x78\x51\x33\x15\x0a\x02",
'Çë' => "\x78\x51\x33\x15\x0a\x05",
'Q'  => "\x78\x51\x33\x16\x0a\x02",
'Çp' => "\x78\x51\x33\x16\x0a\x05",
'r'  => "\x78\x52\x33\x15\x0a\x02",
'Çí' => "\x78\x52\x33\x15\x0a\x05",
'R'  => "\x78\x52\x33\x16\x0a\x02",
'Çq' => "\x78\x52\x33\x16\x0a\x05",
's'  => "\x78\x53\x33\x15\x0a\x02",
'Çì' => "\x78\x53\x33\x15\x0a\x05",
'S'  => "\x78\x53\x33\x16\x0a\x02",
'Çr' => "\x78\x53\x33\x16\x0a\x05",
't'  => "\x78\x54\x33\x15\x0a\x02",
'Çî' => "\x78\x54\x33\x15\x0a\x05",
'T'  => "\x78\x54\x33\x16\x0a\x02",
'Çs' => "\x78\x54\x33\x16\x0a\x05",
'u'  => "\x78\x55\x33\x15\x0a\x02",
'Çï' => "\x78\x55\x33\x15\x0a\x05",
'U'  => "\x78\x55\x33\x16\x0a\x02",
'Çt' => "\x78\x55\x33\x16\x0a\x05",
'v'  => "\x78\x56\x33\x15\x0a\x02",
'Çñ' => "\x78\x56\x33\x15\x0a\x05",
'V'  => "\x78\x56\x33\x16\x0a\x02",
'Çu' => "\x78\x56\x33\x16\x0a\x05",
'w'  => "\x78\x57\x33\x15\x0a\x02",
'Çó' => "\x78\x57\x33\x15\x0a\x05",
'W'  => "\x78\x57\x33\x16\x0a\x02",
'Çv' => "\x78\x57\x33\x16\x0a\x05",
'x'  => "\x78\x58\x33\x15\x0a\x02",
'Çò' => "\x78\x58\x33\x15\x0a\x05",
'X'  => "\x78\x58\x33\x16\x0a\x02",
'Çw' => "\x78\x58\x33\x16\x0a\x05",
'y'  => "\x78\x59\x33\x15\x0a\x02",
'Çô' => "\x78\x59\x33\x15\x0a\x05",
'Y'  => "\x78\x59\x33\x16\x0a\x02",
'Çx' => "\x78\x59\x33\x16\x0a\x05",
'z'  => "\x78\x5a\x33\x15\x0a\x02",
'Çö' => "\x78\x5a\x33\x15\x0a\x05",
'Z'  => "\x78\x5a\x33\x16\x0a\x02",
'Çy' => "\x78\x5a\x33\x16\x0a\x05",
'Çü' => "\x79\x41\x34\x1b\x10\x03",
'É@' => "\x79\x41\x34\x1b\x11\x03",
'ß'  => "\x79\x41\x34\x1b\x11\x04",
'Ç†' => "\x79\x41\x34\x1d\x10\x03",
'ÉA' => "\x79\x41\x34\x1d\x11\x03",
'±'  => "\x79\x41\x34\x1d\x11\x04",
'Ç°' => "\x79\x42\x34\x1b\x10\x03",
'ÉB' => "\x79\x42\x34\x1b\x11\x03",
'®'  => "\x79\x42\x34\x1b\x11\x04",
'Ç¢' => "\x79\x42\x34\x1d\x10\x03",
'ÉC' => "\x79\x42\x34\x1d\x11\x03",
'≤'  => "\x79\x42\x34\x1d\x11\x04",
'Ç£' => "\x79\x43\x34\x1b\x10\x03",
'ÉD' => "\x79\x43\x34\x1b\x11\x03",
'©'  => "\x79\x43\x34\x1b\x11\x04",
'Ç§' => "\x79\x43\x34\x1d\x10\x03",
'ÉE' => "\x79\x43\x34\x1d\x11\x03",
'≥'  => "\x79\x43\x34\x1d\x11\x04",
'Éî' => "\x79\x43\x35\x1d\x11\x03",
'≥ﬁ' => "\x79\x43\x35\x1d\x11\x04",
'Ç•' => "\x79\x44\x34\x1b\x10\x03",
'ÉF' => "\x79\x44\x34\x1b\x11\x03",
'™'  => "\x79\x44\x34\x1b\x11\x04",
'Ç¶' => "\x79\x44\x34\x1d\x10\x03",
'ÉG' => "\x79\x44\x34\x1d\x11\x03",
'¥'  => "\x79\x44\x34\x1d\x11\x04",
'Çß' => "\x79\x45\x34\x1b\x10\x03",
'ÉH' => "\x79\x45\x34\x1b\x11\x03",
'´'  => "\x79\x45\x34\x1b\x11\x04",
'Ç®' => "\x79\x45\x34\x1d\x10\x03",
'ÉI' => "\x79\x45\x34\x1d\x11\x03",
'µ'  => "\x79\x45\x34\x1d\x11\x04",
'Éï' => "\x79\x51\x34\x1b\x11\x03",
'Ç©' => "\x79\x51\x34\x1d\x10\x03",
'ÉJ' => "\x79\x51\x34\x1d\x11\x03",
'∂'  => "\x79\x51\x34\x1d\x11\x04",
'Ç™' => "\x79\x51\x35\x1d\x10\x03",
'ÉK' => "\x79\x51\x35\x1d\x11\x03",
'∂ﬁ' => "\x79\x51\x35\x1d\x11\x04",
'Ç´' => "\x79\x52\x34\x1d\x10\x03",
'ÉL' => "\x79\x52\x34\x1d\x11\x03",
'∑'  => "\x79\x52\x34\x1d\x11\x04",
'Ç¨' => "\x79\x52\x35\x1d\x10\x03",
'ÉM' => "\x79\x52\x35\x1d\x11\x03",
'∑ﬁ' => "\x79\x52\x35\x1d\x11\x04",
'Ç≠' => "\x79\x53\x34\x1d\x10\x03",
'ÉN' => "\x79\x53\x34\x1d\x11\x03",
'∏'  => "\x79\x53\x34\x1d\x11\x04",
'ÇÆ' => "\x79\x53\x35\x1d\x10\x03",
'ÉO' => "\x79\x53\x35\x1d\x11\x03",
'∏ﬁ' => "\x79\x53\x35\x1d\x11\x04",
'Éñ' => "\x79\x54\x34\x1b\x11\x03",
'ÇØ' => "\x79\x54\x34\x1d\x10\x03",
'ÉP' => "\x79\x54\x34\x1d\x11\x03",
'π'  => "\x79\x54\x34\x1d\x11\x04",
'Ç∞' => "\x79\x54\x35\x1d\x10\x03",
'ÉQ' => "\x79\x54\x35\x1d\x11\x03",
'πﬁ' => "\x79\x54\x35\x1d\x11\x04",
'Ç±' => "\x79\x55\x34\x1d\x10\x03",
'ÉR' => "\x79\x55\x34\x1d\x11\x03",
'∫'  => "\x79\x55\x34\x1d\x11\x04",
'Ç≤' => "\x79\x55\x35\x1d\x10\x03",
'ÉS' => "\x79\x55\x35\x1d\x11\x03",
'∫ﬁ' => "\x79\x55\x35\x1d\x11\x04",
'Ç≥' => "\x79\x61\x34\x1d\x10\x03",
'ÉT' => "\x79\x61\x34\x1d\x11\x03",
'ª'  => "\x79\x61\x34\x1d\x11\x04",
'Ç¥' => "\x79\x61\x35\x1d\x10\x03",
'ÉU' => "\x79\x61\x35\x1d\x11\x03",
'ªﬁ' => "\x79\x61\x35\x1d\x11\x04",
'Çµ' => "\x79\x62\x34\x1d\x10\x03",
'ÉV' => "\x79\x62\x34\x1d\x11\x03",
'º'  => "\x79\x62\x34\x1d\x11\x04",
'Ç∂' => "\x79\x62\x35\x1d\x10\x03",
'ÉW' => "\x79\x62\x35\x1d\x11\x03",
'ºﬁ' => "\x79\x62\x35\x1d\x11\x04",
'Ç∑' => "\x79\x63\x34\x1d\x10\x03",
'ÉX' => "\x79\x63\x34\x1d\x11\x03",
'Ω'  => "\x79\x63\x34\x1d\x11\x04",
'Ç∏' => "\x79\x63\x35\x1d\x10\x03",
'ÉY' => "\x79\x63\x35\x1d\x11\x03",
'Ωﬁ' => "\x79\x63\x35\x1d\x11\x04",
'Çπ' => "\x79\x64\x34\x1d\x10\x03",
'ÉZ' => "\x79\x64\x34\x1d\x11\x03",
'æ'  => "\x79\x64\x34\x1d\x11\x04",
'Ç∫' => "\x79\x64\x35\x1d\x10\x03",
'É[' => "\x79\x64\x35\x1d\x11\x03",
'æﬁ' => "\x79\x64\x35\x1d\x11\x04",
'Çª' => "\x79\x65\x34\x1d\x10\x03",
(qw/É\ /)[0]
     => "\x79\x65\x34\x1d\x11\x03",
'ø'  => "\x79\x65\x34\x1d\x11\x04",
'Çº' => "\x79\x65\x35\x1d\x10\x03",
'É]' => "\x79\x65\x35\x1d\x11\x03",
'øﬁ' => "\x79\x65\x35\x1d\x11\x04",
'ÇΩ' => "\x79\x71\x34\x1d\x10\x03",
'É^' => "\x79\x71\x34\x1d\x11\x03",
'¿'  => "\x79\x71\x34\x1d\x11\x04",
'Çæ' => "\x79\x71\x35\x1d\x10\x03",
'É_' => "\x79\x71\x35\x1d\x11\x03",
'¿ﬁ' => "\x79\x71\x35\x1d\x11\x04",
'Çø' => "\x79\x72\x34\x1d\x10\x03",
'É`' => "\x79\x72\x34\x1d\x11\x03",
'¡'  => "\x79\x72\x34\x1d\x11\x04",
'Ç¿' => "\x79\x72\x35\x1d\x10\x03",
'Éa' => "\x79\x72\x35\x1d\x11\x03",
'¡ﬁ' => "\x79\x72\x35\x1d\x11\x04",
'Ç¡' => "\x79\x73\x34\x1b\x10\x03",
'Éb' => "\x79\x73\x34\x1b\x11\x03",
'Ø'  => "\x79\x73\x34\x1b\x11\x04",
'Ç¬' => "\x79\x73\x34\x1d\x10\x03",
'Éc' => "\x79\x73\x34\x1d\x11\x03",
'¬'  => "\x79\x73\x34\x1d\x11\x04",
'Ç√' => "\x79\x73\x35\x1d\x10\x03",
'Éd' => "\x79\x73\x35\x1d\x11\x03",
'¬ﬁ' => "\x79\x73\x35\x1d\x11\x04",
'Çƒ' => "\x79\x74\x34\x1d\x10\x03",
'Ée' => "\x79\x74\x34\x1d\x11\x03",
'√'  => "\x79\x74\x34\x1d\x11\x04",
'Ç≈' => "\x79\x74\x35\x1d\x10\x03",
'Éf' => "\x79\x74\x35\x1d\x11\x03",
'√ﬁ' => "\x79\x74\x35\x1d\x11\x04",
'Ç∆' => "\x79\x75\x34\x1d\x10\x03",
'Ég' => "\x79\x75\x34\x1d\x11\x03",
'ƒ'  => "\x79\x75\x34\x1d\x11\x04",
'Ç«' => "\x79\x75\x35\x1d\x10\x03",
'Éh' => "\x79\x75\x35\x1d\x11\x03",
'ƒﬁ' => "\x79\x75\x35\x1d\x11\x04",
'Ç»' => "\x79\x81\x34\x1d\x10\x03",
'Éi' => "\x79\x81\x34\x1d\x11\x03",
'≈'  => "\x79\x81\x34\x1d\x11\x04",
'Ç…' => "\x79\x82\x34\x1d\x10\x03",
'Éj' => "\x79\x82\x34\x1d\x11\x03",
'∆'  => "\x79\x82\x34\x1d\x11\x04",
'Ç ' => "\x79\x83\x34\x1d\x10\x03",
'Ék' => "\x79\x83\x34\x1d\x11\x03",
'«'  => "\x79\x83\x34\x1d\x11\x04",
'ÇÀ' => "\x79\x84\x34\x1d\x10\x03",
'Él' => "\x79\x84\x34\x1d\x11\x03",
'»'  => "\x79\x84\x34\x1d\x11\x04",
'ÇÃ' => "\x79\x85\x34\x1d\x10\x03",
'Ém' => "\x79\x85\x34\x1d\x11\x03",
'…'  => "\x79\x85\x34\x1d\x11\x04",
'ÇÕ' => "\x79\x91\x34\x1d\x10\x03",
'Én' => "\x79\x91\x34\x1d\x11\x03",
' '  => "\x79\x91\x34\x1d\x11\x04",
'ÇŒ' => "\x79\x91\x35\x1d\x10\x03",
'Éo' => "\x79\x91\x35\x1d\x11\x03",
' ﬁ' => "\x79\x91\x35\x1d\x11\x04",
'Çœ' => "\x79\x91\x36\x1d\x10\x03",
'Ép' => "\x79\x91\x36\x1d\x11\x03",
' ﬂ' => "\x79\x91\x36\x1d\x11\x04",
'Ç–' => "\x79\x92\x34\x1d\x10\x03",
'Éq' => "\x79\x92\x34\x1d\x11\x03",
'À'  => "\x79\x92\x34\x1d\x11\x04",
'Ç—' => "\x79\x92\x35\x1d\x10\x03",
'Ér' => "\x79\x92\x35\x1d\x11\x03",
'Àﬁ' => "\x79\x92\x35\x1d\x11\x04",
'Ç“' => "\x79\x92\x36\x1d\x10\x03",
'És' => "\x79\x92\x36\x1d\x11\x03",
'Àﬂ' => "\x79\x92\x36\x1d\x11\x04",
'Ç”' => "\x79\x93\x34\x1d\x10\x03",
'Ét' => "\x79\x93\x34\x1d\x11\x03",
'Ã'  => "\x79\x93\x34\x1d\x11\x04",
'Ç‘' => "\x79\x93\x35\x1d\x10\x03",
'Éu' => "\x79\x93\x35\x1d\x11\x03",
'Ãﬁ' => "\x79\x93\x35\x1d\x11\x04",
'Ç’' => "\x79\x93\x36\x1d\x10\x03",
'Év' => "\x79\x93\x36\x1d\x11\x03",
'Ãﬂ' => "\x79\x93\x36\x1d\x11\x04",
'Ç÷' => "\x79\x94\x34\x1d\x10\x03",
'Éw' => "\x79\x94\x34\x1d\x11\x03",
'Õ'  => "\x79\x94\x34\x1d\x11\x04",
'Ç◊' => "\x79\x94\x35\x1d\x10\x03",
'Éx' => "\x79\x94\x35\x1d\x11\x03",
'Õﬁ' => "\x79\x94\x35\x1d\x11\x04",
'Çÿ' => "\x79\x94\x36\x1d\x10\x03",
'Éy' => "\x79\x94\x36\x1d\x11\x03",
'Õﬂ' => "\x79\x94\x36\x1d\x11\x04",
'ÇŸ' => "\x79\x95\x34\x1d\x10\x03",
'Éz' => "\x79\x95\x34\x1d\x11\x03",
'Œ'  => "\x79\x95\x34\x1d\x11\x04",
'Ç⁄' => "\x79\x95\x35\x1d\x10\x03",
'É{' => "\x79\x95\x35\x1d\x11\x03",
'Œﬁ' => "\x79\x95\x35\x1d\x11\x04",
'Ç€' => "\x79\x95\x36\x1d\x10\x03",
'É|' => "\x79\x95\x36\x1d\x11\x03",
'Œﬂ' => "\x79\x95\x36\x1d\x11\x04",
'Ç‹' => "\x79\xa1\x34\x1d\x10\x03",
'É}' => "\x79\xa1\x34\x1d\x11\x03",
'œ'  => "\x79\xa1\x34\x1d\x11\x04",
'Ç›' => "\x79\xa2\x34\x1d\x10\x03",
'É~' => "\x79\xa2\x34\x1d\x11\x03",
'–'  => "\x79\xa2\x34\x1d\x11\x04",
'Çﬁ' => "\x79\xa3\x34\x1d\x10\x03",
'ÉÄ' => "\x79\xa3\x34\x1d\x11\x03",
'—'  => "\x79\xa3\x34\x1d\x11\x04",
'Çﬂ' => "\x79\xa4\x34\x1d\x10\x03",
'ÉÅ' => "\x79\xa4\x34\x1d\x11\x03",
'“'  => "\x79\xa4\x34\x1d\x11\x04",
'Ç‡' => "\x79\xa5\x34\x1d\x10\x03",
'ÉÇ' => "\x79\xa5\x34\x1d\x11\x03",
'”'  => "\x79\xa5\x34\x1d\x11\x04",
'Ç·' => "\x79\xb1\x34\x1b\x10\x03",
'ÉÉ' => "\x79\xb1\x34\x1b\x11\x03",
'¨'  => "\x79\xb1\x34\x1b\x11\x04",
'Ç‚' => "\x79\xb1\x34\x1d\x10\x03",
'ÉÑ' => "\x79\xb1\x34\x1d\x11\x03",
'‘'  => "\x79\xb1\x34\x1d\x11\x04",
'Ç„' => "\x79\xb3\x34\x1b\x10\x03",
'ÉÖ' => "\x79\xb3\x34\x1b\x11\x03",
'≠'  => "\x79\xb3\x34\x1b\x11\x04",
'Ç‰' => "\x79\xb3\x34\x1d\x10\x03",
'ÉÜ' => "\x79\xb3\x34\x1d\x11\x03",
'’'  => "\x79\xb3\x34\x1d\x11\x04",
'ÇÂ' => "\x79\xb5\x34\x1b\x10\x03",
'Éá' => "\x79\xb5\x34\x1b\x11\x03",
'Æ'  => "\x79\xb5\x34\x1b\x11\x04",
'ÇÊ' => "\x79\xb5\x34\x1d\x10\x03",
'Éà' => "\x79\xb5\x34\x1d\x11\x03",
'÷'  => "\x79\xb5\x34\x1d\x11\x04",
'ÇÁ' => "\x79\xc1\x34\x1d\x10\x03",
'Éâ' => "\x79\xc1\x34\x1d\x11\x03",
'◊'  => "\x79\xc1\x34\x1d\x11\x04",
'ÇË' => "\x79\xc2\x34\x1d\x10\x03",
'Éä' => "\x79\xc2\x34\x1d\x11\x03",
'ÿ'  => "\x79\xc2\x34\x1d\x11\x04",
'ÇÈ' => "\x79\xc3\x34\x1d\x10\x03",
'Éã' => "\x79\xc3\x34\x1d\x11\x03",
'Ÿ'  => "\x79\xc3\x34\x1d\x11\x04",
'ÇÍ' => "\x79\xc4\x34\x1d\x10\x03",
'Éå' => "\x79\xc4\x34\x1d\x11\x03",
'⁄'  => "\x79\xc4\x34\x1d\x11\x04",
'ÇÎ' => "\x79\xc5\x34\x1d\x10\x03",
'Éç' => "\x79\xc5\x34\x1d\x11\x03",
'€'  => "\x79\xc5\x34\x1d\x11\x04",
'ÇÏ' => "\x79\xd1\x34\x1b\x10\x03",
'Éé' => "\x79\xd1\x34\x1b\x11\x03",
'ÇÌ' => "\x79\xd1\x34\x1d\x10\x03",
'Éè' => "\x79\xd1\x34\x1d\x11\x03",
'‹'  => "\x79\xd1\x34\x1d\x11\x04",
'ÇÓ' => "\x79\xd2\x34\x1d\x10\x03",
'Éê' => "\x79\xd2\x34\x1d\x11\x03",
'ÇÔ' => "\x79\xd4\x34\x1d\x10\x03",
'Éë' => "\x79\xd4\x34\x1d\x11\x03",
'Ç' => "\x79\xd5\x34\x1d\x10\x03",
'Éí' => "\x79\xd5\x34\x1d\x11\x03",
'¶'  => "\x79\xd5\x34\x1d\x11\x04",
'ÇÒ' => "\x79\xd6\x34\x1d\x10\x03",
'Éì' => "\x79\xd6\x34\x1d\x11\x03",
'›'  => "\x79\xd6\x34\x1d\x11\x04",
'ÅT' => "\x79\xd7\x34\x1c\x10\x03",
'ÅR' => "\x79\xd7\x34\x1c\x11\x03",
'ÅU' => "\x79\xd7\x35\x1c\x10\x03",
'ÅS' => "\x79\xd7\x35\x1c\x11\x03",
'Å[' => "\x79\xd8\x34\x1a\x11\x03",
'∞'  => "\x79\xd8\x34\x1a\x11\x04",
'ÅV' => "\x7a\x41\x32\x14\x0a\x01",
'ÅW' => "\x7a\x42\x32\x14\x0a\x01",
'ÅX' => "\x7a\x43\x32\x14\x0a\x01",
'ÅY' => "\x7a\x44\x32\x14\x0a\x01",
'ÅZ' => "\x7a\x45\x32\x14\x0a\x01",
'Å¨' => "\xfe\xfc\x32\x14\x0a\x01",
);

sub _getOrder { wantarray ? %Order : \%Order }

sub _getClass($) {
    my $w = ord shift; # weight
    return
	$w <  0x70 ?  0 : # ignorable
	$w == 0x70 ?  1 : # space
	$w == 0x71 ?  2 : # kijutsu kigou   : descriptive symbols
	$w == 0x72 ?  3 : # kakko kigou     : quotes and parentheses
	$w == 0x73 ?  4 : # gakujutsu kigou : math. operators and sci. symbols
	$w == 0x74 ?  5 : # ippan kigou     : general symbols
	$w == 0x75 ?  6 : # unit symbols
	$w == 0x76 ?  7 : # arabic digits
	$w == 0x77 ?  8 : # ooji kigou      : Greek and Cyrillic alphabets
	$w == 0x78 ?  9 : # Latin alphabets
	$w == 0x79 ? 10 : # kana
	$w <= 0xfc ? 11 : # kanji
	             12 ; # geta
}
sub getClass { # method for testing _getClass()
    my $self = shift;
    my $key  = $self->getSortKey(shift);
    return _getClass($key);
}

my %Replaced;
my @Replaced = qw( Å[  ∞  ÅT  ÅR  ÅU  ÅS );
@Replaced{@Replaced} = (1) x @Replaced;

sub _replaced($$) {
    my $c = shift; # current element
    my $p = unpack('n', shift);
      # weight at the 1st level of the previous element
    return unless 0x7941 <= $p && $p <= 0x79d6;

    my $d = $p % 16; # dan : a-i-u-e-o or others
    my $n = pack('n', $p);
    return
	$c eq 'Å['
	    ? "\x79".chr($d == 6 ? 0xd6 : 0x40 + $d)."\x34\x1a\x11\x03" :
	$c eq '∞'
	    ? "\x79".chr($d == 6 ? 0xd6 : 0x40 + $d)."\x34\x1a\x11\x04" :
	$c eq 'ÅT'
	    ? "$n\x34\x1c\x10\x03" :
	$c eq 'ÅR'
	    ? "$n\x34\x1c\x11\x03" :
	$c eq 'ÅU' && # has Daku Hiragana
		 $n =~ /^\x79[\x51-\x55\x61-\x65\x71-\x75\x91-\x95]/
	    ? "$n\x35\x1c\x10\x03" :
	$c eq 'ÅS' && # has Daku Katakana
		 $n =~ /^\x79[\x43\x51-\x55\x61-\x65\x71-\x75\x91-\x95]/
	    ? "$n\x35\x1c\x11\x03" :
	    undef;
}

sub _length {
    my $str = shift;
    0 + $str =~ s/[\x81-\x9F\xE0-\xFC][\x00-\xFF]|[\x00-\xFF]//g;
}

sub getWtCJK {
    my $self = shift;
    my $c    = shift;
    if ($self->{kanji} == 3) {
	my $u = &{ $self->{tounicode} }($c);
	croak "A passed codepoint of kanji is outside CJK Unified Ideographs"
	    unless 0x4E00 <= $u && $u <= 0x9FFF;
	my $d = $u - 0x4E00;
	chr(int($d / 192) + 0x80).chr($d % 192 + 0x40)."\x32\x14\x0a\x01";
    } else {
	"$c\x32\x14\x0a\x01";
    }
}

sub getWt {
    my $self = shift;
    my $str  = $self->{preprocess} ? &{ $self->{preprocess} }(shift) : shift;
    my $kan  = $self->{kanji};
    my $ign  = $self->{ignoreChar};

    if ($str !~ m/^(?:$Char)*$/o) {
	carp $PACKAGE . " Malformed Shift-JIS character";
    }

    my($c, @buf);
    foreach $c ($str =~ m/$Char/go) {
	next unless $Order{$c} || $kan > 1 && $c =~ /^$CJK$/o;
	next if defined $ign && $c =~ /$ign/;

	my $replaced;
	$replaced = _replaced($c, $buf[-1]) if $Replaced{$c} && @buf;

	push @buf,
	    $replaced  ? $replaced  :
	    $Order{$c} ? $Order{$c} :
	    $kan > 1   ? $self->getWtCJK($c) : ();
    }
    return wantarray ? @buf : join('', @buf);
}

sub getSortKey {
    my $self = shift;
    my $wt   = $self->getWt(shift);
    my $lev  = $self->{level};
    my @ret;

    ($ret[0] = $wt) =~ tr/\x40-\xff//cd if 0 < $lev;
    ($ret[1] = $wt) =~ tr/\x32-\x36//cd if 1 < $lev;
    ($ret[2] = $wt) =~ tr/\x14-\x1d//cd if 2 < $lev;
    ($ret[3] = $wt) =~ tr/\x0a-\x11//cd if 3 < $lev;
    ($ret[4] = $wt) =~ tr/\x01-\x05//cd if 4 < $lev;

    # 3rd level
    $ret[2] =~ tr/\x15\x16/\x16\x15/
	if 2 < $lev && $self->{upper_before_lower};

    # 4th level
    $ret[3] =~ tr/\x10\x11/\x11\x10/
	if 3 < $lev && $self->{katakana_before_hiragana};

    join "\0\0", @ret[0..$lev-1];
}

sub cmp { $_[0]->getSortKey($_[1]) cmp $_[0]->getSortKey($_[2]) }
sub eq  { $_[0]->getSortKey($_[1]) eq  $_[0]->getSortKey($_[2]) }
sub ne  { $_[0]->getSortKey($_[1]) ne  $_[0]->getSortKey($_[2]) }
sub gt  { $_[0]->getSortKey($_[1]) gt  $_[0]->getSortKey($_[2]) }
sub ge  { $_[0]->getSortKey($_[1]) ge  $_[0]->getSortKey($_[2]) }
sub lt  { $_[0]->getSortKey($_[1]) lt  $_[0]->getSortKey($_[2]) }
sub le  { $_[0]->getSortKey($_[1]) le  $_[0]->getSortKey($_[2]) }

sub sort {
    my $obj = shift;
    my(%hyoki);
    foreach (@_) {
	$hyoki{$_} = $obj->getSortKey($_);
    }
    return sort{ $hyoki{$a} cmp $hyoki{$b} } @_;
}

sub sortYomi {
    my $obj = shift;
    my (%hyoki, %yomi);
    my @str = @_;
    foreach (@str) {
	$hyoki{ $_->[0] } = $obj->getSortKey($_->[0]);
	$yomi{  $_->[1] } = $obj->getSortKey($_->[1]);
    }

    return sort {
	    $yomi{ $a->[1] } cmp $yomi{ $b->[1] }
	 || $hyoki{ $a->[0] } cmp $hyoki{ $b->[0] }
	} @str;
}

sub sortDaihyo {
    my $obj = shift;
    my (%class, %hyoki, %yomi, %daihyo, %kashira);
    my @str = @_;
    foreach (@str) {
	$hyoki{   $_->[0] } = $obj->getSortKey(  $_->[0] ); # string
	$yomi{    $_->[1] } = $obj->getSortKey(  $_->[1] ); # string
	$daihyo{  $_->[1] } = unpack('n', $yomi{ $_->[1]}); # number
	$kashira{ $_->[0] } = unpack('n', $hyoki{$_->[0]}); # number
	$class{   $_->[0] } = _getClass( $hyoki{$_->[0]} ); # number
    }

    sort{ $class{  $a->[0] } <=> $class{  $b->[0] }
	|| $daihyo{ $a->[1] } <=> $daihyo{ $b->[1] }
	|| $kashira{$a->[0] } <=> $kashira{$b->[0] }
	|| $yomi{   $a->[1] } cmp $yomi{   $b->[1] }
	|| $hyoki{  $a->[0] } cmp $hyoki{  $b->[0] }
    } @str;
}

##
## int = index(string, substring)
##
sub index {
    my $self = shift;
    my $str  = $self->{preprocess} ? &{ $self->{preprocess} }(shift) : shift;
    my $sub  = shift;
    my $byte = $self->{position_in_bytes};
    my $kan  = $self->{kanji};
    my $ign  = $self->{ignoreChar};
    my $lev  = $self->{level};

    my @subWt = $self->getWt($sub);
    return wantarray ? (0,0) : 0 if ! @subWt;
    return wantarray ?  ()  : -1 if $str eq '';

    if ($str !~ m/^(?:$Char)*$/o) {
	carp $PACKAGE . " Malformed Shift-JIS character";
    }

    my $count = 0;
    my($c, $prev, @strWt, @strPt);
    foreach $c ($str =~ m/$Char/go) {
	my $cur;
	next if defined $ign && $c =~ /$ign/;
	if ($Order{$c} || $kan > 1 && $c =~ /^$CJK$/o) {
	    $cur   = _replaced($c, $strWt[-1]) if $Replaced{$c} && @strWt;
	    $cur ||= $Order{$c} ? $Order{$c} :
	    $kan > 1   ? $self->getWtCJK($c) : undef;
	}

	if ($cur) {
	    push @strWt, $cur;
	    push @strPt, $count;
	}
	$count += $byte ? length($c) : _length($c);

	while (@strWt >= @subWt) {
	    if (_eqArray(\@strWt, \@subWt, $lev)) {
		my $pos = $strPt[0];
		return wantarray ? ($pos, $count-$pos) : $pos;
	    }
	    shift @strWt;
	    shift @strPt;
	}
    }
    return wantarray ? () : -1;
}

##
## bool _eqArray(arrayref, arrayref, level)
##
sub _eqArray($$$) {
    my $a   = shift; # length $a >= length $b;
    my $b   = shift;
    my $len = 1 + shift; # 1 + level

    my($c);
    foreach $c (0..@$b-1) {
	return if substr($a->[$c], 0, $len) ne substr($b->[$c], 0, $len);
    }
    return 1;
}

1;

__END__

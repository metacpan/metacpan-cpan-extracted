<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<refentry><refmeta><refentrytitle>wdcompile</refentrytitle><manvolnum>1</manvolnum></refmeta><refnamediv><refname>wdcompile</refname><refpurpose>parse and display internal data representation of WebDyne files</refpurpose></refnamediv><refsynopsisdiv><cmdsynopsis><command>wdcompile [OPTIONS] FILE</command></cmdsynopsis></refsynopsisdiv><refsection><title>Description</title><para>The <command>wdcompile</command> command displays internal compiled (Storable) representation of a .psp page using the WebDyne perl module.</para><para>WebDyne parses HTML into an intermediate format which is then stored to disk to speed up subsequent rendering of pages. It is dependent on HTML::Treebuilder and HTML::Parser modules
    to build the tree, and results are stored to disk in a data array format via the Storable module.</para><para>The parser may build incorrect representations on a HTML tree if the HTML is badly formed or there are errors in the WebDyne compiler itself. This utility is useful for diagnosing
    any such errors.</para><para>The parser interprets files in 3 main stages (and some lesser intermediate stages that do not impact data structure but are used in the test suites): a full HTML::TreeBuilder
    representation of all tags with no optimisation, an intermediate partial optimisation stage that re-renders tags with no dynamic components (e.g. no &lt;perl> or similar tags) back into
    static HTML and a final fully optimised file that should only contain a data structure for dynamic components of the page.</para><para>The final data structure contains various artifacts used by the render engine such as a manifest section, and notation of line numbers for dynamic sections to aid in error display
    and source file tracebacks should an error occur in any dynamic code at render time.</para></refsection><refsection><title>Options</title><para><variablelist><varlistentry><term>-h, --help</term><listitem><para>Show brief help message.</para></listitem></varlistentry><varlistentry><term>--meta</term><listitem><para>Show just the file metadata in compile output</para></listitem></varlistentry><varlistentry><term>--data</term><listitem><para>Show just the file data structure in compile output, no meta data. This is the default</para></listitem></varlistentry><varlistentry><term>--all</term><listitem><para>Show both the file meta and core data in output</para></listitem></varlistentry><varlistentry><term>--[no]manifest</term><listitem><para>Do/do not populate the filename into the metadata manifest section. Only used in test suite.</para></listitem></varlistentry><varlistentry><term>--[no]timestamp</term><listitem><para>Do/do not populate the timestamp into the metadata manifest section. Only used in test suite.</para></listitem></varlistentry><varlistentry><term>--[no]perl</term><listitem><para>Do/do not run Perl in __PERL__ section at compile time. The default is to not run any Perl sections.</para></listitem></varlistentry><varlistentry><term>--[no]filter</term><listitem><para>Do/do not run any filter stages that may be nominated in the file.</para></listitem></varlistentry><varlistentry><term>--outfile</term><listitem><para>Specify the output file to save the Storable representation of the data.</para></listitem></varlistentry><varlistentry><term>--repeat | --r | --num | --n</term><listitem><para>Specify the number of times to repeat the compile. Used for consistency testing</para></listitem></varlistentry><varlistentry><term>--stage[n]|stage0|stage1|stage2|stage3|stage4|stage5|final</term><listitem><para>Stop at a certain stage of the compile process. The default is to compile to final representation. The most significant intermediate stages are stage 0 for the raw tree,
            stage 4 for the first intermediate compile optimisation and stage 5 (final) for final optimisation.</para></listitem></varlistentry><varlistentry><term>--man</term><listitem><para>Display the full manual.</para></listitem></varlistentry><varlistentry><term>--version</term><listitem><para>Display the script version and exit.</para></listitem></varlistentry></variablelist></para></refsection><refsection><title>Examples</title><para><programlisting language="sh"># Reference file saved as time.psp
#
&lt;start_html>
The current server time is: &lt;? localtime() ?>
</programlisting><programlisting language="sh"># Show the final compiled data structure of time.psp
#
$ wdcompile time.psp

$VAR1 = [
  '&lt;!DOCTYPE html>&lt;html lang="en">&lt;head>&lt;title>Untitled Document&lt;/title>&lt;meta charset="UTF-8">&lt;meta content="width=device-width, initial-scale=1.0" name="viewport">&lt;/head>
&lt;body>&lt;p>The current server time is: ',
  [
    'perl',
    {
      'inline' => 1,
      'perl' => ' localtime() '
    },
    undef,
    undef,
    2,
    2,
    \'time.psp'
  ],
  '&lt;/p>&lt;/body>&lt;/html>'
];
</programlisting><programlisting language="sh"># Show the initial compiled data structure (stage 0) of the time.psp file including metadata
#
$ wdcompile --all --stage0 time.psp

$VAR1 = [
  {
    'manifest' => [
      'time.psp'
    ]
  },
  [
    'html',
    {
      'lang' => 'en'
    },
    [
      [
        'head',
        undef,
        [
          [
            'title',
            undef,
            [
              'Untitled Document'
            ],
            undef,
            1,
            1,
            \$VAR1->[0]{'manifest'}[0]
            ...
</programlisting></para></refsection><refsection><title>Notes</title><para>The <command>wdcompile</command> command will attempt to build the HTML tree as faithfully as possible from the command line environment, but may not be able to interpret all HTML
    files, especially those with malformed HTML tags. It is reliant on HTML::TreeBuilder and HTML::Parser. If you are sure your HTML is compliant (all tags closed, all attributes double quoted
    etc.) and wdcompile is still producing a malformed tree you can submit a big report with the smallest possible HTML file needed to replicate the issue.</para></refsection><refsection><title>Author</title><para>Written by Andrew Speer, <email>andrew@webdyne.org</email></para></refsection><refsection><title>LICENSE and COPYRIGHT</title><para>This file is part of WebDyne.</para><para>This software is copyright (c) 2025 by Andrew Speer &lt;andrew.speer@isolutions.com.au>.</para><para>This is free software; you can redistribute it and/or modify it underthe same terms as the Perl 5 programming language system itself.</para><para>Full license text is available at:</para><para>&lt;http://dev.perl.org/licenses/></para></refsection></refentry>
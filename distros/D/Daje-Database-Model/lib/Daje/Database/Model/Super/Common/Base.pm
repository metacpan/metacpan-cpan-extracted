package Daje::Database::Model::Super::Common::Base;
use Mojo::Base -base, -signatures;

# Autogenerated class Fri Feb 28 17:44:08 2025
# Any manual changes to this class will be overwritten next time its generated

has 'db';

sub load_pk($self, $table, $select, $primary_key_name, $primary_key) {
    my $result->{result} = 1;
    eval {
        my $load = $self->db->select(
            $table,
                [$select],
                {$primary_key_name => $primary_key}
        );
        $result->{data} = {};
        $result->{data} = $load->hash if $load and $load->rows > 0;
    };
    if($@) {
        $result->{result} = 0;
        $result->{data} = "";
        $result->{error} = $@;
    };
    return $result;
};

sub load_fkey($self, $table, $select, $foreign_key_name, $foreign_key) {
    my $result->{result} = 1;
    eval {
        my $load = $self->db->select(
            $table,
                [$select],
            {$foreign_key_name => $foreign_key}
        );
        $result->{data} = {};
        $result->{data} = $load->hashes if $load and $load->rows > 0;
    };
    if($@) {
        $result->{result} = 0;
        $result->{data} = "";
        $result->{error} = $@;
    };
    return $result;
}

sub load_a_list($self, $table, $select, $key_value) {
    my $result->{result} = 1;
     eval {
        my $load = $self->db->select(
            $table,
                [$select],
            {$key_value}
        );
        $result->{data} = {};
        $result->{data} = $load->hashes if $load and $load->rows > 0;
    };
     if($@) {
        $result->{result} = 0;
        $result->{data} = "";
        $result->{error} = $@;
    };

    return $result;
}

sub insert($self, $table, $data, $primary_key_name) {
    my $result->{result} = 1;
    eval {
        my $primary_key = $self->db->insert(
            $table, %$data,
                { returning => $primary_key_name }
        );
        $result->{data} = {};
        $result->{data} = $primary_key->hashes
            if $primary_key and $primary_key->rows > 0;
    };
    if($@) {
        $result->{error} = $@;
        $result->{result} = 0;
        $result->{data} = {};
    };

    return $result;
}

sub update($self, $table, $data, $keys) {
    my $result->{result} = 1;
    eval {
        $self->db->update($table, $data, $keys);
    };
     if($@) {
        $result->{error} = $@;
        $result->{result} = 0;
    }
    return $result;
}

1;


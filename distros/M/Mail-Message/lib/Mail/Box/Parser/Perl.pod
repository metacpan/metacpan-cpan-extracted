=encoding utf8

=head1 NAME

Mail::Box::Parser::Perl - reading messages from file using Perl

=head1 INHERITANCE

 Mail::Box::Parser::Perl
   is a Mail::Box::Parser
   is a Mail::Reporter

=head1 SYNOPSIS

=head1 DESCRIPTION

The C<Mail::Box::Parser::Perl> implements parsing of messages
in Perl.  This may be a little slower than the C<C> based parser
L<Mail::Box::Parser::C|Mail::Box::Parser::C>, but will also work on platforms where no C
compiler is available.

Extends L<"DESCRIPTION" in Mail::Box::Parser|Mail::Box::Parser/"DESCRIPTION">.

=head1 METHODS

Extends L<"METHODS" in Mail::Box::Parser|Mail::Box::Parser/"METHODS">.

=head2 Constructors

Extends L<"Constructors" in Mail::Box::Parser|Mail::Box::Parser/"Constructors">.

=over 4

=item $class-E<gt>B<new>(%options)

Inherited, see L<Mail::Box::Parser/"METHODS">

 -Option           --Defined in       --Default
  file                                  undef
  filename                              <required>
  fix_header_errors  Mail::Box::Parser  false
  log                Mail::Reporter     'WARNINGS'
  mode                                  'r'
  trace              Mail::Reporter     'WARNINGS'
  trusted            Mail::Box::Parser  false

=over 2

=item file => $filehandle

Any IO::File or C<GLOB> C<$filehandle> which can be used to read
the data from.  In case this option is specified, the C<filename> is
informational only.

=item filename => FILENAME

The name of the file to be read.

=item fix_header_errors => BOOLEAN

=item log => LEVEL

=item mode => $mode

File open C<$mode>, which defaults to C<'r'>, which means `read-only'.
See C<perldoc -f open> for possible modes.  Only applicable
when no C<file> is specified.

=item trace => LEVEL

=item trusted => BOOLEAN

=back

=back

=head2 Attributes

Extends L<"Attributes" in Mail::Box::Parser|Mail::Box::Parser/"Attributes">.

=over 4

=item $any-E<gt>B<defaultParserType>( [$class] )

Inherited, see L<Mail::Box::Parser/"Attributes">

=item $obj-E<gt>B<file>()

Z<>

=item $obj-E<gt>B<filename>()

Returns the name of the file this parser is working on.

=item $obj-E<gt>B<fixHeaderErrors>( [BOOLEAN] )

Inherited, see L<Mail::Box::Parser/"Attributes">

=item $obj-E<gt>B<logSettings>()

Inherited, see L<Mail::Reporter/"Attributes">

=item $obj-E<gt>B<openMode>()

Z<>

=item $obj-E<gt>B<trusted>()

Inherited, see L<Mail::Box::Parser/"Attributes">

=back

=head2 Parsing

Extends L<"Parsing" in Mail::Box::Parser|Mail::Box::Parser/"Parsing">.

=over 4

=item $obj-E<gt>B<bodyAsFile>( $fh [$chars, [$lines]] )

Inherited, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<bodyAsList>( [$chars, [$lines]] )

Inherited, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<bodyAsString>( [$chars, [$lines]] )

Inherited, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<bodyDelayed>( [$chars, [$lines]] )

Inherited, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<closeFile>()

Close the file which was being parsed.

=item $obj-E<gt>B<fileChanged>()

Returns whether the file which is parsed has changed after the last
time takeFileInfo() was called.

=item $obj-E<gt>B<filePosition>( [$position] )

Returns the location of the next byte to be used in the file which is
parsed.  When a C<$position> is specified, the location in the file is
moved to the indicated spot first.

=item $obj-E<gt>B<lineSeparator>()

Inherited, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<openFile>(%options)

[3.012] Open the file to be parsed.

=item $obj-E<gt>B<readHeader>()

Inherited, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<restart>(%options)

Restart the parser on a certain file, usually because the content has
changed.  The C<%options> are passed to L<openFile()|Mail::Box::Parser::Perl/"Parsing">.

=item $obj-E<gt>B<start>(%options)

Start the parser by opening a file.

 -Option--Default
  file    undef

=over 2

=item file => FILEHANDLE|undef

The file is already open, for instance because the data must be read
from STDIN.

=back

=item $obj-E<gt>B<stop>()

Stop the parser, which will include a close of the file.  The lock on the
folder will not be removed (is not the responsibility of the parser).
Improves base, see L<Mail::Box::Parser/"Parsing">

=item $obj-E<gt>B<takeFileInfo>()

Capture some data about the file being parsed, to be compared later.

=back

=head2 Error handling

Extends L<"Error handling" in Mail::Box::Parser|Mail::Box::Parser/"Error handling">.

=over 4

=item $obj-E<gt>B<AUTOLOAD>()

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<addReport>($object)

Inherited, see L<Mail::Reporter/"Error handling">

=item $any-E<gt>B<defaultTrace>( [$level]|[$loglevel, $tracelevel]|[$level, $callback] )

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<errors>()

Inherited, see L<Mail::Reporter/"Error handling">

=item $any-E<gt>B<log>( [$level, [$strings]] )

Inherited, see L<Mail::Reporter/"Error handling">

=item $any-E<gt>B<logPriority>($level)

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<notImplemented>()

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<report>( [$level] )

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<reportAll>( [$level] )

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<trace>( [$level] )

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<warnings>()

Inherited, see L<Mail::Reporter/"Error handling">

=back

=head2 Cleanup

Extends L<"Cleanup" in Mail::Box::Parser|Mail::Box::Parser/"Cleanup">.

=over 4

=item $obj-E<gt>B<DESTROY>()

Inherited, see L<Mail::Reporter/"Cleanup">

=back

=head1 DIAGNOSTICS

=over 4

=item Warning: File $file changed during access.

When a message parser starts working, it takes size and modification time
of the file at hand.  If the folder is written, it checks whether there
were changes in the file made by external programs.

Calling L<Mail::Box::update()|Mail::Box/"The folder"> on a folder before it being closed
will read these new messages.  But the real source of this problem is
locking: some external program (for instance the mail transfer agent,
like sendmail) uses a different locking mechanism as you do and therefore
violates your rights.
Cast by C<stop()>

=item Error: Package $package does not implement $method.

Fatal error: the specific package (or one of its superclasses) does not
implement this method where it should. This message means that some other
related classes do implement this method however the class at hand does
not.  Probably you should investigate this and probably inform the author
of the package.
Cast by C<notImplemented()>

=item Warning: Unexpected end of header in $source: $line

While parsing a message from the specified source (usually a file name),
the parser found a syntax error.  According to the MIME specification in the
RFCs, each header line must either contain a colon, or start with a blank
to indicate a folded field.  Apparently, this header contains a line which
starts on the first position, but not with a field name.

By default, parsing of the header will be stopped.  If there are more header
lines after the erroneous line, they will be added to the body of the message.
In case of L<new(fix_header_errors)|Mail::Box::Parser/"METHODS"> set, the parsing of the header will be continued.
The erroneous line will be added to the preceding field.
Cast by C<readHeader()>

=back

=head1 SEE ALSO

This module is part of Mail-Message version 3.019,
built on November 24, 2025. Website: F<http://perl.overmeer.net/CPAN/>

=head1 LICENSE

For contributors see file ChangeLog.

This software is copyright (c) 2001-2025 by Mark Overmeer.

This is free software; you can redistribute it and/or modify it under
the same terms as the Perl 5 programming language system itself.


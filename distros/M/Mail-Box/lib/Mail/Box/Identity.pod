=encoding utf8

=head1 NAME

Mail::Box::Identity - represents an unopened folder

=head1 INHERITANCE

 Mail::Box::Identity
   is a User::Identity::Item

 Mail::Box::Identity
   is a Mail::Reporter

=head1 SYNOPSIS

  use User::Identity;
  use Mail::Box::Identity;
  my $me   = User::Identity->new(...);

  my $mailbox = Mail::Box::Identity->new(...);
  $me->add(folders => $mailbox);

  # Simpler

  use User::Identity;
  my $me   = User::Identity->new(...);
  my $addr = $me->add(folders => ...);

=head1 DESCRIPTION

The C<Mail::Box::Identity> object contains the description of a
single mailbox.  The mailboxes are collected by an L<Mail::Box::Collection|Mail::Box::Collection>
object.  This corresponds with IMAP's C<\NoSelect>, for instance.

Nearly all methods can return C<undef>.

Extends L<"DESCRIPTION" in Mail::Reporter|Mail::Reporter/"DESCRIPTION">.

Extends L<"DESCRIPTION" in User::Identity::Item|User::Identity::Item/"DESCRIPTION">.

=head1 METHODS

Extends L<"METHODS" in Mail::Reporter|Mail::Reporter/"METHODS">.

Extends L<"METHODS" in User::Identity::Item|User::Identity::Item/"METHODS">.

=head2 Constructors

Extends L<"Constructors" in Mail::Reporter|Mail::Reporter/"Constructors">.

Extends L<"Constructors" in User::Identity::Item|User::Identity::Item/"Constructors">.

=over 4

=item $class-E<gt>B<new>( [$name], %options )

Inherited, see L<Mail::Reporter/"Constructors">

 -Option     --Defined in          --Default
  deleted                            <C<false>>
  description  User::Identity::Item  undef
  folder_type                        from parent
  inferiors                          1
  location                           undef
  manager                            <from parent>
  marked                             undef
  name         User::Identity::Item  <required>
  only_subs                          <foldertype and name dependent>
  parent       User::Identity::Item  undef
  subf_type                          <same as parent>

=over 2

=item deleted => BOOLEAN

The folder is flagged for deletion.  This not have any implications yet,
because it may still get undeleted.

=item description => STRING

=item folder_type => CLASS

=item inferiors => BOOLEAN

Can this folder have children?  If not, this is cleared.

=item location => $directory|$file

The location of this folder.  Often, only the manager can figure-out
where this folder really is.

=item manager => $object

Any L<Mail::Box::Manager|Mail::Box::Manager> or L<Mail::Box::Manage::User|Mail::Box::Manage::User> C<$object>.

=item marked => 0|1|undef

Whether the folder is flagged for some reason, for instance because
new messages have arrived.

=item name => STRING

=item only_subs => BOOLEAN

Some folder types can have messages in their toplevel folder, other
cannot. That determines the default.
See L<Mail::Box::topFolderWithMessages()|Mail::Box/"Sub-folders">

=item parent => OBJECT

=item subf_type => $class

The type for a subfolder collection, must extend class
L<Mail::Box::Collection|Mail::Box::Collection>.

=back

=back

=head2 Attributes

Extends L<"Attributes" in Mail::Reporter|Mail::Reporter/"Attributes">.

Extends L<"Attributes" in User::Identity::Item|User::Identity::Item/"Attributes">.

=over 4

=item $obj-E<gt>B<deleted>( [BOOLEAN] )

Z<>

=item $obj-E<gt>B<description>()

Inherited, see L<User::Identity::Item/"Attributes">

=item $obj-E<gt>B<folderType>()

Returns the type of this folder.

=item $obj-E<gt>B<fullname>( [$delimeter] )

Returns the name of the folder, from the toplevel until this one, with
the C<$delimeter> string between each level.  C<$delimeter> default to a forward
slash (a C</>).

=item $obj-E<gt>B<inferiors>( [BOOLEAN] )

C<Inferiors> are C<subfolders>.  When this flag is set, it is permitted
to create subfolders.

=item $obj-E<gt>B<location>( [$filename|$directory|undef] )

Returns the directory or filename of the folder.  If this is not pre-defined,
it is computed based on the knowledge about the folder type.  Be sure to set
the location of the toplevel folder to the folderdir of the user to get
this to work.

=item $obj-E<gt>B<manager>()

Returns the manager (usually a L<Mail::Box::Manage::User|Mail::Box::Manage::User> which owns
the folders.  May be undefined, by default from parent.

=item $obj-E<gt>B<marked>( [BOOLEAN|undef] )

When something special has happened with the folder, this flag can
be set (or cleared).  The C<undef> status is an "unknown".  In the
IMAP4 protocol, C<0> will result in a C<\Unmarked>, a C<1> results
in a C<\Marked>, and C<undef> in nothing.

=item $obj-E<gt>B<name>( [$newname] )

Inherited, see L<User::Identity::Item/"Attributes">

=item $obj-E<gt>B<onlySubfolders>( [BOOLEAN] )

Than this folder be opened (without trying) or not?  The default
depends on the folder type, and whether this is the toplevel folder
or not.  See L<Mail::Box::topFolderWithMessages()|Mail::Box/"Sub-folders">

=item $obj-E<gt>B<topfolder>()

Run up the tree to find the highest level folder.

=back

=head2 Collections

Extends L<"Collections" in User::Identity::Item|User::Identity::Item/"Collections">.

=over 4

=item $obj-E<gt>B<add>($collection, $role)

Inherited, see L<User::Identity::Item/"Collections">

=item $obj-E<gt>B<addCollection>( $object | <[$type], %options> )

Inherited, see L<User::Identity::Item/"Collections">

=item $obj-E<gt>B<collection>($name)

Inherited, see L<User::Identity::Item/"Collections">

=item $obj-E<gt>B<parent>( [$parent] )

Inherited, see L<User::Identity::Item/"Collections">

=item $obj-E<gt>B<removeCollection>($object|$name)

Inherited, see L<User::Identity::Item/"Collections">

=item $any-E<gt>B<type>()

Inherited, see L<User::Identity::Item/"Collections">

=item $obj-E<gt>B<user>()

Inherited, see L<User::Identity::Item/"Collections">

=back

=head2 Searching

Extends L<"Searching" in User::Identity::Item|User::Identity::Item/"Searching">.

=over 4

=item $obj-E<gt>B<find>($collection, $role)

Inherited, see L<User::Identity::Item/"Searching">

=back

=head2 Error handling

Extends L<"Error handling" in Mail::Reporter|Mail::Reporter/"Error handling">.

=over 4

=item $obj-E<gt>B<AUTOLOAD>()

Inherited, see L<Mail::Reporter/"Error handling">

=item $obj-E<gt>B<notImplemented>()

Inherited, see L<Mail::Reporter/"Error handling">

=back

=head2 Cleanup

Extends L<"Cleanup" in Mail::Reporter|Mail::Reporter/"Cleanup">.

=over 4

=item $obj-E<gt>B<DESTROY>()

Inherited, see L<Mail::Reporter/"Cleanup">

=back

=head2 Subfolders

=over 4

=item $obj-E<gt>B<addSubfolder>(Mail::Box::Identity-object|$data)

Add a new folder into the administration.  With C<$data>, a new object
will be instantiated first.  The identity is returned on success.

=item $obj-E<gt>B<folder>( [..., $name] )

Returns the subfolder's object with C<$name> or C<undef> if it does not
exist.  When multiple NAMEs are added, those super folders are traverst
first.  Without any C<$name>, the current object is returned

» example: get some folder

  my $a = $user->folders->folder('b', 'a');

  my $name  = "a:b:c";
  my $delim = ":";
  my $f = $user->folders->folder(split $delim, $name);

=item $obj-E<gt>B<foreach>(CODE)

For each of the subfolders found below this point call C<CODE>.  This current
folder is called first.  Be warned that you may find identities with
the L<deleted()|Mail::Box::Identity/"Attributes"> flag on.

=item $obj-E<gt>B<open>(%options)

Open the folder which is described by this identity.  Returned is some
L<Mail::Box|Mail::Box>.  The options are passed to L<Mail::Box::Manager::open()|Mail::Box::Manager/"Manage open folders">.

=item $obj-E<gt>B<remove>( [$name] )

Remove the folder (plus subfolders) with the C<$name>.  Without C<$name>, this
C<Mail::Box::Identity> itself is removed.

The removed structure is returned, which is C<undef> if not
found.  This is only an administrative remove, you still need a
L<Mail::Box::Manager::delete()|Mail::Box::Manager/"Manage existing folders">.

=item $obj-E<gt>B<rename>( $folder, [$newsubname] )

Move the folder to a different super-C<$folder>, under a NEW SUBfolder NAME.

» example: renaming a folder

  my $top = $user->topfolder;
  my $new = $top->folder('xyz') or die;
  my $f   = $top->folder('abc', 'def')->rename($new, '123');

  print $f->name;      # 123
  print $f->fullname;  # =/xyz/123

=item $obj-E<gt>B<subfolderNames>()

Convenience method: returns the names of the collected subfolders.

=item $obj-E<gt>B<subfolders>()

Returns the subfolders or C<undef> if there are none.  This
information is lazy evaluated and cached.  In LIST context, the folder
objects are returned (L<Mail::Box::Identity|Mail::Box::Identity> objects), in SCALAR context
the collection, the L<Mail::Box::Collection|Mail::Box::Collection>.

=back

=head1 DIAGNOSTICS

=over 4

=item Error: cannot load collection module for $type ($class): $@

Either the specified C<$type> does not exist, or that module named C<$class> returns
compilation errors.  If the type as specified in the warning is not
the name of a package, you specified a nickname which was not defined.
Maybe you forgot the 'require' the package which defines the nickname.
Cast by C<addCollection()>

=item Error: class $package does not implement method $method.

Fatal error: the specific C<$package> (or one of its superclasses) does not
implement this method where it should. This message means that some other
related classes do implement this method however the class at hand does
not.  Probably you should investigate this and probably inform the author
of the package.
Cast by C<notImplemented()>

=item Error: it is not permitted to add subfolders to $folder.

The L<inferiors()|Mail::Box::Identity/"Attributes"> flag prohibits the creation of subfolders to this
folder.
Cast by C<addSubfolder()>

=item Error: nvalid collection $name.

The collection with C<$name> does not exist and can not be created.
Cast by C<add()>

=item Error: the toplevel folder cannot be removed this way

The L<Mail::Box::Identity|Mail::Box::Identity> folder administration structure requires
a top directory.  That top is registered somewhere (for instance
by a L<Mail::Box::Manage::User|Mail::Box::Manage::User>).  If you need to remove the top,
you have to look for a method of that object.
Cast by C<remove()>

=item Error: this $object is not a collection.

Cast by C<addCollection()>

=item Error: toplevel directory requires explicit folder type.

Cast by C<folderType()>

=item Error: toplevel directory requires explicit location.

Cast by C<location()>

=back

=head1 SEE ALSO

This module is part of Mail-Box version 4.01,
built on December 13, 2025. Website: F<http://perl.overmeer.net/CPAN/>

=head1 LICENSE

For contributors see file ChangeLog.

This software is copyright (c) 2001-2025 by Mark Overmeer.

This is free software; you can redistribute it and/or modify it under
the same terms as the Perl 5 programming language system itself.


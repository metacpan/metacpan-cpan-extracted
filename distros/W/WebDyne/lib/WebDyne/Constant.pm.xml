<?xml version="1.0" encoding="UTF-8"?>
<refentry version="5.2" xmlns="http://docbook.org/ns/docbook">
  <refmeta>
    <refentrytitle>WebDyne::Constant</refentrytitle>

    <manvolnum>3pm</manvolnum>
  </refmeta>

  <refnamediv>
    <refname>WebDyne::Constant</refname>

    <refpurpose>WebDyne module that sets constants and defaults for WebDyne processing</refpurpose>
  </refnamediv>

  <refsynopsisdiv>
    <programlisting>#!/usr/bin/env perl
#
use WebDyne::Constant;
print $WEBDYNE_DTD</programlisting>

    <screen># Dump all constant settings for review
#
$ perl -MWebDyne::Constant=dump</screen>
  </refsynopsisdiv>

  <refsection>
    <title>Description</title>

    <para>This module provides a list of configuration constantDs used in the WebDyne code. These constants are used to configure the behavior of the WebDyne module and can be accessed by
    importing the module and referencing the constants by name. Constants can be configured to different values by overriding values in local configuration files, setting environment
    variables, command line options, or Apache directives.</para>

    <para>Common uses for modifying constant values allow for:</para>

    <itemizedlist>
      <listitem>
        <para>Changing default language from en-US to something else.</para>
      </listitem>

      <listitem>
        <para>Modifying or adding new meta-data or default headers to output</para>
      </listitem>

      <listitem>
        <para>Adding default style-sheets or other inclusions to all output files</para>
      </listitem>
    </itemizedlist>

    <para>Default values for these configuration constants can be updated the following locations:</para>

    <orderedlist>
      <listitem>
        <para>/etc/webdyne.conf.pl</para>
      </listitem>

      <listitem>
        <para>$HOME/.webdyne.conf.pl</para>
      </listitem>

      <listitem>
        <para>$DOCUMENT_ROOT/.webdyne.conf.pl</para>
      </listitem>
    </orderedlist>

    <para>As a special case when running under PSGI environments, if WEBDYNE_DIR_CONFIG_CWD_LOAD is true (which it is by default) then each directory that a .psp file is run from is checked
    for the .webdyne.conf.pl file - but only WEBDYNE_DIR_CONFIG entries from the file are loaded. This allows for configuration of settings such a WebDyneChain modules to load, WebDyneTemplate
    configuration etc. on a per directory basis</para>

    <para>The WebDyne::Constant module is sub-classed by other WebDyne modules, and the values for any constants in the WebDyne::&lt;Module&gt;::Constant family of modules can be overridden by
    creating/updating one of the above two files. Here is a sample configuration file:</para>

    <programlisting>$_={

    #  Update config constants for WebDyne::Constant module
    #
    'WebDyne::Constant' =&gt; {

        #  Where the cache directory will live
        #
        WEBDYNE_CACHE_DN            =&gt; '/tmp',
 
        #  The attributes below will be added to any &lt;start_html&gt; tag, effectively
        #  adding two stylesheets to every page
        #
        WEBDYNE_START_HTML_PARAM    =&gt; {
          style =&gt; [qw(
            https://cdn.jsssdelivr.net/npm/@picocss/pico@2/css/pico.classless.m
            /style.css
          )]
        },

        #  Enable extended error display
        #
        WEBDYNE_ERROR_SHOW_EXTENDED =&gt; 1,

        #  Update CGI upload capacity to 2GB
        #
        WEBDYNE_CGI_POST_MAX        =&gt; (2048*1024),

        #  Handle examples directory differently
        #
        WEBDYNE_DIR_CONFIG =&gt; {
            '/examples' =&gt; {
                'WebDyneHandler'    =&gt; 'WebDyne::Chain',
                'WebDyneChain'      =&gt; 'WebDyne::Session',
            },
        },

  },

  #  And for WebDyne::Session module
  #
  'WebDyne::Session::Constant' =&gt; {
      WEBDYNE_SESSION_ID_COOKIE_NAME =&gt; 'mysession'  
  },
};</programlisting>

    <warning>
      <para>Ensure the configuration file has the correct syntax by checking the Perl interpreter doesn't throw any errors. Use <command>perl -c -w</command> to check syntax:</para>

      <screen># perl -c -w /etc/webdyne.conf.pl
/etc/webdyne.conf.pl syntax OK
# perl -c -w ~/.webdyne.conf.pl
/home/&lt;user&gt;/.webdyne.conf.pl OK</screen>
    </warning>
  </refsection>

  <refsection>
    <title>CONSTANTS</title>

    <para>The following configuration constants are defined. The default value of the configuration item is provided after the constant name. Most can be overridden or adjusted however where
    they are read-only this is noted.</para>

    <variablelist>
      <varlistentry>
        <term>WEBDYNE_CACHE_DN ()</term>

        <listitem>
          <para>Directory where compiled pages are stored. Unset by default on command line, usually set to temporary directory by installer or PSGI handler. Pages that are compiled from .psp
          source into an intermediate data structure in Storable format are stored in this location.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_STARTUP_CACHE_FLUSH (1)</term>

        <listitem>
          <para>Flush cache files at startup. If set will delete all cache files and force re-read and recompile of all source .psp files at startup. Recommended to leave at (1)</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CACHE_CHECK_FREQ (256)</term>

        <listitem>
          <para>Perl process frequency (number of runs) to check cache for excess entries and clean any that exceed the cache high water mark.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CACHE_HIGH_WATER (64)</term>

        <listitem>
          <para>High water mark for cache entries. Once this limit is reaped cache entries will be deleted down to the low water mark level.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CACHE_LOW_WATER (32)</term>

        <listitem>
          <para>Low water mark for cache entries. Once high water mark is reached cached entries will be deleted down to this level.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CACHE_CLEAN_METHOD (1)</term>

        <listitem>
          <para>Method to clean cache (0: last used time, 1: frequency of use).</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_EVAL_SAFE (0)</term>

        <listitem>
          <para>Type of eval code to run (0: Direct, 1: Safe). All dynamic components of a .psp page are run in an eval block. Running using eval via the Safe module is experimental.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_EVAL_SAFE_OPCODE_AR =&gt; [':default']</term>

        <listitem>
          <para>Opcode set to allow when running in Safe mode.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_EVAL_USE_STRICT ('use strict qw(vars)')</term>

        <listitem>
          <para>Prefix eval code with strict pragma via this string</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_STRICT_VARS (1)</term>

        <listitem>
          <para>Use strict variable checking. If any variables are referenced which are not populated in a render(variable=&gt;&lt;value&gt;) call an error will thrown.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_AUTOLOAD_POLLUTE (0)</term>

        <listitem>
          <para>Pollute WebDyne class with method references for minor speedup. Saves AUTOLOAD trying to find method in call stack but at the price of potentially clashing with an inbuilt
          method. Use with care.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_DUMP_FLAG (0)</term>

        <listitem>
          <para>Flag to display current CGI value and other information if &lt;dump&gt; tag is used.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CONTENT_TYPE_HTML ('text/html')</term>

        <listitem>
          <para>Content-type header for text/html.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CONTENT_TYPE_PLAIN ('text/plain')</term>

        <listitem>
          <para>Content-type header for text/plain.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CONTENT_TYPE_JSON ('application/json')</term>

        <listitem>
          <para>Content-type header for text/json</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_SCRIPT_TYPE_EXECUTABLE_HR</term>

        <listitem>
          <para>Script types which are executable on the browser and won't have substitution imposed on variables that match WebDyne syntax (e.g. ${foo}). includes:</para>

          <itemizedlist>
            <listitem>
              <para>text/javascript</para>
            </listitem>

            <listitem>
              <para>application/javascript</para>
            </listitem>

            <listitem>
              <para>module</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HTML_CHARSET ('UTF-8')</term>

        <listitem>
          <para>Character set for HTML.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_DTD ('&lt;!DOCTYPE html&gt;')</term>

        <listitem>
          <para>DTD to use when generating HTML.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_META ({charset =&gt; 'UTF-8', viewport' =&gt; 'width=device-width, initial-scale=1.0'})</term>

        <listitem>
          <para>Meta information for HTML</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CONTENT_TYPE_HTML_META (0)</term>

        <listitem>
          <para>Include a Content-Type meta tag.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HTML_PARAM ({lang =&gt; 'en'})</term>

        <listitem>
          <para>Default &lt;html&gt; tag parameter attributes</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_START_HTML_PARAM ()</term>

        <listitem>
          <para>Default attributes for any &lt;start_html&gt; tags, e.g. include_style=&gt;['foo.css', 'bar.css']. These will be inserted automatically into any start_html tag seen in any .psp
          page.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_START_HTML_PARAM_STATIC (1)</term>

        <listitem>
          <para>Make include/other sections in start_html tag static, i.e. load them at compile time and they never change. Make undef to force re-include every page load</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HEAD_INSERT ()</term>

        <listitem>
          <para>Anything that should be added in &lt;head&gt; section. Will be inserted verbatim before &lt;/head&gt;. No interpolation or variables, simple text string only. Useful for
          setting global stylesheet, e.g. &lt;link href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css" rel="stylesheet"&gt;. Will be added to all &lt;head&gt; sections
          universally.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_COMPILE_IGNORE_WHITESPACE (1)</term>

        <listitem>
          <para>Ignore ignorable whitespace in compile.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_COMPILE_NO_SPACE_COMPACTING (0)</term>

        <listitem>
          <para>Disable space compacting in compile.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_COMPILE_P_STRICT (1)</term>

        <listitem>
          <para>Use strict parsing in compile.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_COMPILE_IMPLICIT_BODY_P_TAG (1)</term>

        <listitem>
          <para>Implicitly add &lt;body&gt; and &lt;p&gt; tags in compile</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_STORE_COMMENTS (1)</term>

        <listitem>
          <para>Store and render comments.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_NO_CACHE (1)</term>

        <listitem>
          <para>Send no-cache headers.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_WARNINGS_FATAL (0)</term>

        <listitem>
          <para>Treat any warnings as fatal errors.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CGI_DISABLE_UPLOADS (0)</term>

        <listitem>
          <para>Disable CGI uploads. They are enabled by defaults</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CGI_POST_MAX (524288)</term>

        <listitem>
          <para>Max post size for CGI (512KB).</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CGI_PARAM_EXPAND (1)</term>

        <listitem>
          <para>Expand CGI parameters found in CGI names.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CGI_AUTOESCAPE (0)</term>

        <listitem>
          <para>Disable CGI autoescape of form fields.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_TEXT (0)</term>

        <listitem>
          <para>Use text errors rather than HTML.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SHOW (1)</term>

        <listitem>
          <para>Show errors.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SHOW_EXTENDED (0)</term>

        <listitem>
          <para>Show extended error information, including backtraces and source code</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SOURCE_CONTEXT_SHOW (1)</term>

        <listitem>
          <para>Show error source file context.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SOURCE_CONTEXT_LINES_PRE (4)</term>

        <listitem>
          <para>Number of lines to show before error context.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SOURCE_CONTEXT_LINES_POST (4)</term>

        <listitem>
          <para>Number of lines to show after error context.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SOURCE_CONTEXT_LINE_FRAGMENT_MAX (80)</term>

        <listitem>
          <para>Max length of source line to show in output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SOURCE_FILENAME_SHOW (1)</term>

        <listitem>
          <para>Show filename in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_BACKTRACE_SHOW (1)</term>

        <listitem>
          <para>Show backtrace in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_BACKTRACE_SHORT (0)</term>

        <listitem>
          <para>Show brief backtrace.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_EVAL_CONTEXT_SHOW (1)</term>

        <listitem>
          <para>Show eval trace in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_CGI_PARAM_SHOW (1)</term>

        <listitem>
          <para>Show CGI parameters in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_ENV_SHOW (1)</term>

        <listitem>
          <para>Show environment variables in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_WEBDYNE_CONSTANT_SHOW (1)</term>

        <listitem>
          <para>Show WebDyne constants in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_URI_SHOW (1)</term>

        <listitem>
          <para>Show URI in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_VERSION_SHOW (1)</term>

        <listitem>
          <para>Show version in error output.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_EVAL_TEXT_IX (0)</term>

        <listitem>
          <para>Index for error eval text.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ERROR_SHOW_ALTERNATE` ('error display disabled - enable WEBDYNE_ERROR_SHOW to show errors, or review web server error log.')</term>

        <listitem>
          <para>Alternate error message if error display is disabled.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HTML_DEFAULT_TITLE ('Untitled Document')</term>

        <listitem>
          <para>Default title for HTML documents.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HTML_TINY_MODE ('html')</term>

        <listitem>
          <para>Mode for HTML::Tiny object used for generating output (XML or HTML).</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_RELOAD (0)</term>

        <listitem>
          <para>Development mode - recompile loaded modules.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_JSON_CANONICAL (1)</term>

        <listitem>
          <para>Use JSON canonical mode.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HTTP_HEADER (&lt;HashRef&gt;)</term>

        <listitem>
          <para>Default HTTP response headers to send. Includes:</para>

          <itemizedlist>
            <listitem>
              <para>Content-type: text/html; charset=UTF-8</para>
            </listitem>

            <listitem>
              <para>Cache-Control: no-cache, no-store, must-revalidate</para>
            </listitem>

            <listitem>
              <para>Pragma: no-cache</para>
            </listitem>

            <listitem>
              <para>Expires: 0</para>
            </listitem>

            <listitem>
              <para>X-Content-Type-Options: nosniff</para>
            </listitem>

            <listitem>
              <para>X-Frame-Options: SAMEORIGIN</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_API_ENABLE (1)</term>

        <listitem>
          <para>Enable support for the &lt;api&gt; tag. Will cause slight slow-down as routes are converted to .psp file names. Enabled by default.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_ALPINE_VUE_ATTRIBUTE_HACK_ENABLE ('x-on')</term>

        <listitem>
          <para>Converts @click="dosomething()" attributes to x-on:click="dosomething()" in tags as HTML::Parser does not support the '@' character in tag attributes.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_HTTP_HEADER_AJAX_HR ({ hx-request=&gt;1, x-alpine-request=&gt;1 })</term>

        <listitem>
          <para>List of HTTP request headers that denote the request is part of an AJAX (e.g. HTMX) request and only partial HTML response is required.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_PSGI_STATIC (1)</term>

        <listitem>
          <para>Allow the PSGI module to serve static content (css files etc.)</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_PSP_EXT (.psp)</term>

        <listitem>
          <para>Extension for .psp pages. Do not change unless you know what you are doing.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_MIME_TYPE_HR (&lt;HashRef&gt;)</term>

        <listitem>
          <para>Very minimal MIME type hash used by lookup_file function. See file for default content, usual definitions for text, images, style-sheets, PDF etc.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_DIR_CONFIG ()</term>

        <listitem>
          <para>Hash ref that contains location based hierarchy of configuration variables similar to that returned by Apache mod_perl dir_config module. See test (t) directory in source for
          example.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_DIR_CONFIG_CWD_LOAD (1)</term>

        <listitem>
          <para>Enable loading of WEBDYNE_DIR_CONFIG hash ref from the current .psp file working directory if a .webdyne.conf.pl file is present.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>WEBDYNE_CONF_HR (&lt;HashRef&gt;)</term>

        <listitem>
          <para>Read-only value as hash reference showing location of files used to create the values for constants in this module.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>MP2 (mod_perl version)</term>

        <listitem>
          <para>Mod_perl level. Auto-detected, do not change unless you know what you are doing.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>MOD_PERL (mod_perl version)</term>

        <listitem>
          <para>Mod_perl environment runtime detected. Do not change unless you know what you are doing</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </refsection>
</refentry>
